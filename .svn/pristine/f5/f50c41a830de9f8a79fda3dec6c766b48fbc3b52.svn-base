"use strict";var iSlider=function(a){if(!a.dom){throw new Error("dom element can not be empty!")}if(!a.data||!a.data.length){throw new Error("data must be an array and must have more than one element!")}this._opts=a;this._setting();this._renderHTML();this._bindHandler()};iSlider.prototype._setting=function(){var a=this._opts;this.wrap=a.dom;this.data=a.data;this.type=a.type||"pic";this.isVertical=a.isVertical||false;this.isOverspread=a.isOverspread||false;this.duration=a.duration||2000;this.slideIndex=this.slideIndex||0;this.axis=this.isVertical?"Y":"X";this.width=this.wrap.clientWidth;this.height=this.wrap.clientHeight;this.ratio=this.height/this.width;this.scale=a.isVertical?this.height:this.width;this.onslide=a.onslide;this.onslidestart=a.onslidestart;this.onslideend=a.onslideend;this.onslidechange=a.onslidechange;this.offset=this.offset||{X:0,Y:0};if(this.data.length<2){this.isLooping=false;this.isAutoPlay=false}else{this.isLooping=a.isLooping||false;this.isAutoplay=a.isAutoplay||false}if(a.animateType==="card"&&this.isVertical){this.isOverspread=true}if(this.isAutoplay){this.play()}this.log=a.isDebug?function(b){window.console.log(b)}:function(){};this._setUpDamping();this._setPlayWhenFocus();this._animateFunc=(a.animateType in this._animateFuncs)?this._animateFuncs[a.animateType]:this._animateFuncs["default"]};iSlider.prototype._setPlayWhenFocus=function(){var a=this;window.addEventListener("focus",function(){a.isAutoplay&&a.play()},false);window.addEventListener("blur",function(){a.pause()},false)};iSlider.prototype._animateFuncs={"default":function(e,b,d,a,c){e.style.webkitTransform="translateZ(0) translate"+b+"("+(c+d*(a-1))+"px)"},rotate:function(g,b,f,a,e){var c=(b==="X")?"Y":"X";var d=Math.abs(e);var h=window.getComputedStyle(this.wrap.parentNode,null).backgroundColor;if(this.isVertical){e=-e}this.wrap.style.webkitPerspective=f*4;if(a===1){g.style.zIndex=f-d}else{g.style.zIndex=(e>0)?(1-a)*d:(a-1)*d}g.style.cssText+="-webkit-backface-visibility:hidden; -webkit-transform-style:preserve-3d; background-color:"+h+"; position:absolute;";g.style.webkitTransform="rotate"+c+"("+90*(e/f+a-1)+"deg) translateZ("+(0.888*f/2)+"px) scale(0.888)"},flip:function(f,b,e,a,d){var c=(b==="X")?"Y":"X";var g=window.getComputedStyle(this.wrap.parentNode,null).backgroundColor;if(this.isVertical){d=-d}this.wrap.style.webkitPerspective=e*4;if(d>0){f.style.visibility=(a>1)?"hidden":"visible"}else{f.style.visibility=(a<1)?"hidden":"visible"}f.style.cssText+="position:absolute; -webkit-backface-visibility:hidden; background-color:"+g+";";f.style.webkitTransform="translateZ("+(e/2)+"px) rotate"+c+"("+180*(d/e+a-1)+"deg) scale(0.875)"},depth:function(f,b,e,a,d){var c=(4-Math.abs(a-1))*0.18;this.wrap.style.webkitPerspective=e*4;f.style.zIndex=(a===1)?100:(d>0)?(1-a):(a-1);f.style.webkitTransform="scale("+c+", "+c+") translateZ(0) translate"+b+"("+(d+1.3*e*(a-1))+"px)"},flow:function(d,b,c,f,e){var g=Math.abs(e);var j=(b==="X")?"Y":"X";var h=(b==="X")?1:-1;var a=Math.abs(e/c);this.wrap.style.webkitPerspective=c*4;if(f===1){d.style.zIndex=c-g}else{d.style.zIndex=(e>0)?(1-f)*g:(f-1)*g}d.style.webkitTransform="scale(0.7, 0.7) translateZ("+(a*150-150)*Math.abs(f-1)+"px)translate"+b+"("+(e+c*(f-1))+"px)rotate"+j+"("+h*(30-a*30)*(1-f)+"deg)"},card:function(g,b,f,a,e){var d=Math.abs(e);if(a===1){g.style.zIndex=f-d;g.cur=1}else{g.style.zIndex=(e>0)?(1-a)*d*1000:(a-1)*d*1000}if(g.cur&&g.cur!==a){setTimeout(function(){g.cur=null},300)}var c=(g.cur)?1-0.2*Math.abs(a-1)-Math.abs(0.2*e/f).toFixed(6):1;g.style.webkitTransform="scale("+c+", "+c+") translateZ(0) translate"+b+"("+((1+Math.abs(a-1)*0.2)*e+f*(a-1))+"px)"}};iSlider.prototype._setUpDamping=function(){var b=this.scale>>1;var a=b>>1;var c=a>>2;this._damping=function(f){var e=Math.abs(f);var d;if(e<b){d=e>>1}else{if(e<b+a){d=a+((e-b)>>2)}else{d=a+c+((e-b-a)>>3)}}return f>0?d:-d}};iSlider.prototype._renderItem=function(d,c){var e;var b;var a=this.data.length;if(!this.isLooping){e=this.data[c]||{empty:true}}else{if(c<0){e=this.data[a+c]}else{if(c>a-1){e=this.data[c-a]}else{e=this.data[c]}}}if(e.empty){d.innerHTML="";d.style.background="";return}if(this.type==="pic"){if(!this.isOverspread){b=e.height/e.width>this.ratio?'<img height="'+this.height+'" src="'+e.content+'">':'<img width="'+this.width+'" src="'+e.content+'">'}else{d.style.background="url("+e.content+") 50% 50% no-repeat";d.style.backgroundSize="cover"}}else{if(this.type==="dom"){b=e.content}}b&&(d.innerHTML=b)};iSlider.prototype._renderHTML=function(){this.outer&&(this.outer.innerHTML="");var c=this.outer||document.createElement("ul");c.style.cssText="height:"+this.height+"px;width:"+this.width+"px;margin:0;padding:0;list-style:none;";this.els=[];for(var b=0;b<3;b++){var a=document.createElement("li");a.className=this.type==="dom"?"islider-dom":"islider-pic";a.style.cssText="height:"+this.height+"px;width:"+this.width+"px;";this.els.push(a);this._animateFunc(a,this.axis,this.scale,b,0);if(this.isVertical&&(this._opts.animateType==="rotate"||this._opts.animateType==="flip")){this._renderItem(a,1-b+this.slideIndex)}else{this._renderItem(a,b-1+this.slideIndex)}c.appendChild(a)}this._initLoadImg();if(!this.outer){this.outer=c;this.wrap.appendChild(c)}};iSlider.prototype._preloadImg=function(b){if(!this.data[b].loaded){var a=new Image();a.src=this.data[b].content;this.data[b].loaded=1}};iSlider.prototype._initLoadImg=function(){var c=this.data;var a=c.length;var b=this;if(this.type!=="dom"&&a>3){c[0].loaded=1;c[1].loaded=1;if(b.isLooping){c[a-1].loaded=1}setTimeout(function(){if(!c[2].loaded){var d=new Image();d.src=c[2].content;c[2].loaded=1}if(b.isLooping){var e=new Image();e.src=c[a-2].content;c[a-2].loaded=1}},200)}};iSlider.prototype.slideTo=function(j){var h=this.data;var b=this.data.length;var e=this.els;var k=j;var c=j-this.slideIndex;var f=0;if(Math.abs(c)>1){var d=c>0?this.els[2]:this.els[0];this._renderItem(d,k)}if(this.type!=="dom"){if(c>0){f=(k+2>b-1)?((k+2)%b):(k+2);this._preloadImg(f)}else{if(this.isLooping){f=(k-2<0)?(b-2+k):(k-2);this._preloadImg(f)}}}if(h[k]){this.slideIndex=k}else{if(this.isLooping){this.slideIndex=c>0?0:h.length-1}else{this.slideIndex=this.slideIndex;c=0}}this.log("pic idx:"+this.slideIndex);var a;if(this.isVertical&&(this._opts.animateType==="rotate"||this._opts.animateType==="flip")){if(c>0){a=e.pop();e.unshift(a)}else{if(c<0){a=e.shift();e.push(a)}}}else{if(c>0){a=e.shift();e.push(a)}else{if(c<0){a=e.pop();e.unshift(a)}}}if(c!==0){if(Math.abs(c)>1){this._renderItem(e[0],k-1);this._renderItem(e[2],k+1)}else{if(Math.abs(c)===1){this._renderItem(a,k+c)}}a.style.webkitTransition="none";a.style.visibility="hidden";setTimeout(function(){a.style.visibility="visible"},200);this.onslidechange&&this.onslidechange(this.slideIndex)}for(var g=0;g<3;g++){if(e[g]!==a){e[g].style.webkitTransition="all .3s ease"}this._animateFunc(e[g],this.axis,this.scale,g,0)}if(this.isAutoplay&&!this.isLooping&&this.slideIndex===h.length-1){this.pause()}};iSlider.prototype._bindHandler=function(){var k=this;var h=false;var j=k.outer;var f=!!(("ontouchstart" in window)||window.DocumentTouch&&document instanceof window.DocumentTouch);var i=f?"touchstart":"mousedown";var d=f?"touchmove":"mousemove";var b=f?"touchend":"mouseup";var c=function(l){h=true;k.pause();k.onslidestart&&k.onslidestart();k.log("Event: beforeslide");k.startTime=new Date().getTime();k.startX=f?l.targetTouches[0].pageX:l.pageX;k.startY=f?l.targetTouches[0].pageY:l.pageY};var e=function(m){if(h){var l=k.data.length;var p=k.axis;var n=(p==="X")?"Y":"X";var r={X:f?(m.targetTouches[0].pageX-k.startX):(m.pageX-k.startX),Y:f?(m.targetTouches[0].pageY-k.startY):(m.pageY-k.startY)};if(Math.abs(r[p])-Math.abs(r[n])>10){m.preventDefault();k.onslide&&k.onslide(r[p]);k.log("Event: onslide");if(!k.isLooping){if(r[p]>0&&k.slideIndex===0||r[p]<0&&k.slideIndex===l-1){r[p]=k._damping(r[p])}}for(var o=0;o<3;o++){var q=k.els[o];q.style.webkitTransition="all 0s";k._animateFunc(q,p,k.scale,o,r[p])}}k.offset=r}};var g=function(l){h=false;var o=k.offset;var n=k.axis;var p=k.scale/2;var m=new Date().getTime();p=m-k.startTime>300?p:14;if(o[n]>=p){k.slideTo(k.slideIndex-1)}else{if(o[n]<-p){k.slideTo(k.slideIndex+1)}else{k.slideTo(k.slideIndex)}}if(Math.abs(k.offset.X)<10&&Math.abs(k.offset.Y)<10){k.tapEvt=document.createEvent("Event");k.tapEvt.initEvent("tap",true,true);if(!l.target.dispatchEvent(k.tapEvt)){l.preventDefault()}}k.offset.X=k.offset.Y=0;k.isAutoplay&&k.play();k.onslideend&&k.onslideend(k.slideIndex);k.log("Event: afterslide")};var a=function(l){setTimeout(function(){k.reset();k.log("Event: orientationchange")},100)};j.addEventListener(i,c);j.addEventListener(d,e);j.addEventListener(b,g);window.addEventListener("orientationchange",a)};iSlider.prototype.bind=function(d,a,c){function b(h){var f=window.event?window.event:h;var g=f.target;if(("#"+g.id)===a||g.className.indexOf(a.match(/\w+/)[0])!==-1||g.tagName.toLowerCase()===a){c.call(g)}}this.outer.addEventListener(d,b,false)};iSlider.prototype.reset=function(){this.pause();this._setting();this._renderHTML();this.isAutoplay&&this.play()};iSlider.prototype.play=function(){var a=this;var b=this.duration;clearInterval(this.autoPlayTimer);this.autoPlayTimer=setInterval(function(){a.slideTo(a.slideIndex+1)},b)};iSlider.prototype.pause=function(){clearInterval(this.autoPlayTimer)};iSlider.prototype.extend=function(b,a){if(!a){a=iSlider.prototype}Object.keys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))})};
